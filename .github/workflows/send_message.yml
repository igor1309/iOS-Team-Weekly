name: Telegram scheduled messages

on:
  schedule:
    # 11:00 MSK ‚Üí 08:00 UTC (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –≤—Ç–æ—Ä–Ω–∏–∫, –ø—è—Ç–Ω–∏—Ü–∞)
    - cron: '0 8 * * 1'
    - cron: '0 8 * * 2'
    - cron: '0 8 * * 5'
    # 16:50 MSK ‚Üí 13:50 UTC (–≤—Ç–æ—Ä–Ω–∏–∫)
    - cron: '50 13 * * 2'

jobs:
  send:
    runs-on: ubuntu-latest
    env:
      BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      CHAT_ID:  ${{ secrets.CHAT_ID }}
    steps:
      - name: Send Telegram scheduled message
        shell: bash
        env:
          TZ: Europe/Moscow
        run: |
          # —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ date –±—É–¥–µ—Ç –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–π –∑–æ–Ω–µ
          export TZ

          # –Ω–æ–º–µ—Ä –¥–Ω—è –Ω–µ–¥–µ–ª–∏ (1=–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫‚Ä¶7=–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ) –∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è HH:MM
          DAY=$(date +%u)
          TIME=$(date +%H:%M)

          echo "DEBUG: —Å–µ–π—á–∞—Å –ø–æ –ú–æ—Å–∫–≤–µ ${DAY} ${TIME}"

          case "${DAY} ${TIME}" in
            # –ü—è—Ç–Ω–∏—Ü–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ 11:xx
            5 11:*)
              MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –°–µ–≥–æ–¥–Ω—è –ø—è—Ç–Ω–∏—Ü–∞, –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥–æ–∫–ª–∞–¥—á–∏–∫–∞–º–∏ –Ω–∞ iOS Weekly."
              ;;
            # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ 11:xx
            1 11:*)
              MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –ó–∞–≤—Ç—Ä–∞ iOS Weekly. –î–æ–∫–ª–∞–¥—á–∏–∫–∏, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ —Å–≤–æ–∏ –¥–æ–∫–ª–∞–¥—ã!"
              ;;
            # –í—Ç–æ—Ä–Ω–∏–∫ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ 11:xx
            2 11:*)
              MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –°–µ–≥–æ–¥–Ω—è iOS Weekly –≤ 17:00!"
              ;;
            # –í—Ç–æ—Ä–Ω–∏–∫ –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç 50‚Äì59 (16:50‚Äì16:59)
            2 16:5*)
              MESSAGE="üìÖ –£–≤–∏–¥–∏–º—Å—è –≤ 17:00!"
              ;;
            *)
              echo "–ù–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å–µ–π—á–∞—Å ${DAY} ${TIME}), –≤—ã—Ö–æ–¥–∏–º."
              exit 0
              ;;
          esac

          # –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d text="$MESSAGE"
