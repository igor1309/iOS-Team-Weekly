name: Telegram scheduled messages

on:
  schedule:
    # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 11:00 MSK ‚Üí UTC 08:00
    - cron: '0 8 * * 1'
    # –í—Ç–æ—Ä–Ω–∏–∫ 11:00 MSK ‚Üí UTC 08:00
    - cron: '0 8 * * 2'
    # –í—Ç–æ—Ä–Ω–∏–∫ 16:50 MSK ‚Üí UTC 13:50
    - cron: '50 13 * * 2'
    # –ü—è—Ç–Ω–∏—Ü–∞ 11:00 MSK ‚Üí UTC 08:00
    - cron: '0 8 * * 5'

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
      - name: Send Telegram scheduled message
        shell: bash
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID:   ${{ secrets.CHAT_ID }}
          TZ:        Europe/Moscow
        run: |
          # –ø–æ–ª—É—á–∞–µ–º –º–æ—Å–∫–æ–≤—Å–∫–∏–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (1‚Äì–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ‚Ä¶ 7‚Äì–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ) –∏ –≤—Ä–µ–º—è HH:MM
          DAY=$(date +%u)
          TIME=$(date +%H:%M)

          case "${DAY} ${TIME}" in
            # –ü—è—Ç–Ω–∏—Ü–∞ 11:00
            "5 11:00")
              MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –°–µ–≥–æ–¥–Ω—è –ø—è—Ç–Ω–∏—Ü–∞, –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥–æ–∫–ª–∞–¥—á–∏–∫–∞–º–∏ –Ω–∞ iOS Weekly."
              ;;
            # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 11:00
            "1 11:00")
              MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –ó–∞–≤—Ç—Ä–∞ iOS Weekly. –î–æ–∫–ª–∞–¥—á–∏–∫–∏, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ —Å–≤–æ–∏ –¥–æ–∫–ª–∞–¥—ã!"
              ;;
            # –í—Ç–æ—Ä–Ω–∏–∫ 11:00
            "2 11:00")
              MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –°–µ–≥–æ–¥–Ω—è iOS Weekly –≤ 17:00!"
              ;;
            # –í—Ç–æ—Ä–Ω–∏–∫ 16:50
            "2 16:50")
              MESSAGE="üìÖ –£–≤–∏–¥–∏–º—Å—è —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç!"
              ;;
            *)
              echo "–ù–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å–µ–π—á–∞—Å ${DAY} ${TIME}), –≤—ã—Ö–æ–¥–∏–º."
              exit 0
              ;;
          esac

          # —à–ª—ë–º –≤ Telegram
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d text="$MESSAGE"
