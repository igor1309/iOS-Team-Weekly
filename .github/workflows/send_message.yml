name: Telegram scheduled messages

on:
  schedule:
    # 11:00 MSK ‚Üí 08:00 UTC (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –≤—Ç–æ—Ä–Ω–∏–∫, –ø—è—Ç–Ω–∏—Ü–∞)
    - cron: '0 8 * * 1'
    - cron: '0 8 * * 2'
    - cron: '0 8 * * 5'
    # 16:50 MSK ‚Üí 13:50 UTC (–≤—Ç–æ—Ä–Ω–∏–∫)
    - cron: '50 13 * * 2'

jobs:
  send:
    runs-on: ubuntu-latest
    env:
      BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      CHAT_ID:  ${{ secrets.CHAT_ID }}
    steps:
      - name: Send Telegram scheduled message
        shell: bash
        env:
          TZ: Europe/Moscow
        run: |
          export TZ
          DAY=$(date +%u)       # 1=–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ‚Ä¶ 7=–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
          TIME=$(date +%H:%M)   # MSK –≤—Ä–µ–º—è
          echo "DEBUG: —Å–µ–π—á–∞—Å –ø–æ –ú–æ—Å–∫–≤–µ ${DAY} ${TIME}"

          if [ "$DAY" -eq 5 ] && [[ "$TIME" =~ ^11: ]]; then
            MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –°–µ–≥–æ–¥–Ω—è –ø—è—Ç–Ω–∏—Ü–∞, –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥–æ–∫–ª–∞–¥—á–∏–∫–∞–º–∏ –Ω–∞ iOS Weekly."
          elif [ "$DAY" -eq 1 ] && [[ "$TIME" =~ ^11: ]]; then
            MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –ó–∞–≤—Ç—Ä–∞ iOS Weekly. –î–æ–∫–ª–∞–¥—á–∏–∫–∏, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ —Å–≤–æ–∏ –¥–æ–∫–ª–∞–¥—ã!"
          elif [ "$DAY" -eq 2 ] && [[ "$TIME" =~ ^11: ]]; then
            MESSAGE="üìÖ –ü—Ä–∏–≤–µ—Ç! –°–µ–≥–æ–¥–Ω—è iOS Weekly –≤ 17:00!"
          elif [ "$DAY" -eq 2 ] && [[ "$TIME" =~ ^16:5 ]]; then
            MESSAGE="üìÖ –£–≤–∏–¥–∏–º—Å—è —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç!"
          else
            echo "–ù–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å–µ–π—á–∞—Å ${DAY} ${TIME}), –≤—ã—Ö–æ–¥–∏–º."
            exit 0
          fi

          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d text="$MESSAGE"
